{% extends "base.html" %}

{% block title %}æˆ‘çš„é¡¹ç›®{% endblock %}

{% block content %}
    <h1>æˆ‘çš„é¡¹ç›® ğŸš€</h1>
    <p>è¿™é‡Œå±•ç¤ºäº†æˆ‘åœ¨ GitHub ä¸Šçš„ä¸€äº›å¼€æºé¡¹ç›®å’ŒæŠ€æœ¯æ¢ç´¢ã€‚æ¯ä¸ªé¡¹ç›®éƒ½ä½“ç°äº†æˆ‘åœ¨ä¸åŒæŠ€æœ¯é¢†åŸŸçš„å­¦ä¹ å’Œå®è·µã€‚</p>

    <!-- GitHub ç”¨æˆ·ç»Ÿè®¡åŒºåŸŸ -->
    <div class="github-stats-section">
        <h2>ğŸ“Š GitHub æ´»åŠ¨ç»Ÿè®¡</h2>
        <div id="github-stats" class="stats-container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“¦</div>
                    <div class="stat-content">
                        <span class="stat-number">{{ total_repos }}</span>
                        <span class="stat-label">å±•ç¤ºé¡¹ç›®</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â­</div>
                    <div class="stat-content">
                        <span class="stat-number">{{ total_stars }}</span>
                        <span class="stat-label">è·å¾—æ˜Ÿæ ‡</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ´</div>
                    <div class="stat-content">
                        <span class="stat-number">{{ total_forks }}</span>
                        <span class="stat-label">é¡¹ç›®åˆ†å‰</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ’»</div>
                    <div class="stat-content">
                        <span class="stat-number">{{ unique_languages.len() }}</span>
                        <span class="stat-label">ç¼–ç¨‹è¯­è¨€</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡¹ç›®æœç´¢å’Œè¿‡æ»¤åŒºåŸŸ -->
    <div class="project-controls">
        <div class="search-container">
            <input type="text" id="project-search" placeholder="ğŸ” æœç´¢é¡¹ç›®..." class="search-input">
        </div>
        <div class="filter-container">
            <select id="language-filter" class="filter-select">
                <option value="all">æ‰€æœ‰è¯­è¨€</option>
                {% for lang in unique_languages %}
                    <option value="{{ lang }}">{{ lang }}</option>
                {% endfor %}
            </select>
            <select id="sort-filter" class="filter-select">
                <option value="updated">æœ€è¿‘æ›´æ–°</option>
                <option value="stars">æœ€å¤šæ˜Ÿæ ‡</option>
                <option value="name">é¡¹ç›®åç§°</option>
                <option value="created">åˆ›å»ºæ—¶é—´</option>
            </select>
            <button id="clear-filters" class="btn btn-small btn-secondary">æ¸…é™¤ç­›é€‰</button>
        </div>
    </div>

    <!-- é¡¹ç›®å±•ç¤ºåŒºåŸŸ -->
    <div id="projects-container" class="projects-grid">
        {% if repos.is_empty() %}
            <div class="no-projects">
                <p>ğŸ”„ æ­£åœ¨åŠ è½½é¡¹ç›®æ•°æ®...</p>
                <p>å¦‚æœæŒç»­æ˜¾ç¤ºæ­¤æ¶ˆæ¯ï¼Œå¯èƒ½æ˜¯GitHub APIè®¿é—®å—é™ã€‚</p>
            </div>
        {% else %}
            {% for repo in repos %}
                <div class="project-card" 
                     data-language="{{ repo.language.as_ref().unwrap_or(&String::from("Unknown")) }}"
                     data-stars="{{ repo.stargazers_count }}"
                     data-updated="{{ repo.updated_at }}"
                     data-created="{{ repo.created_at }}"
                     data-name="{{ repo.name }}">
                    
                    <div class="project-header">
                        <h3 class="project-title">
                            <a href="{{ repo.html_url }}" target="_blank" rel="noopener">
                                {{ repo.name }}
                            </a>
                        </h3>
                        {% if repo.language.is_some() %}
                            <span class="language-badge" data-language="{{ repo.language.as_ref().unwrap() }}">
                                {{ repo.language.as_ref().unwrap() }}
                            </span>
                        {% endif %}
                    </div>

                    {% if repo.description.is_some() %}
                        <p class="project-description">{{ repo.description.as_ref().unwrap() }}</p>
                    {% else %}
                        <p class="project-description">æš‚æ— æè¿°</p>
                    {% endif %}

                    <div class="project-stats">
                        <span class="stat">
                            <span class="stat-icon">â­</span>
                            <span class="stat-value">{{ repo.stargazers_count }}</span>
                        </span>
                        <span class="stat">
                            <span class="stat-icon">ğŸ´</span>
                            <span class="stat-value">{{ repo.forks_count }}</span>
                        </span>
                        {% if repo.size > 0 %}
                            <span class="stat">
                                <span class="stat-icon">ğŸ“¦</span>
                                <span class="stat-value">{{ repo.size }} KB</span>
                            </span>
                        {% endif %}
                    </div>

                    <div class="project-meta">
                        <span class="update-time">
                            ğŸ“… æ›´æ–°äº {{ repo.updated_at }}
                        </span>
                    </div>

                    <div class="project-actions">
                        <a href="{{ repo.html_url }}" 
                           target="_blank" 
                           rel="noopener" 
                           class="btn btn-primary btn-small">
                            æŸ¥çœ‹ä»£ç 
                        </a>
                        {% if repo.homepage.is_some() && !repo.homepage.as_ref().unwrap().is_empty() %}
                            <a href="{{ repo.homepage.as_ref().unwrap() }}" 
                               target="_blank" 
                               rel="noopener" 
                               class="btn btn-secondary btn-small">
                                è®¿é—®ç½‘ç«™
                            </a>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- é¡¹ç›®åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading-indicator" class="loading-indicator" style="display: none;">
        <div class="loading-spinner"></div>
        <p>æ­£åœ¨åŠ è½½é¡¹ç›®æ•°æ®...</p>
    </div>

    <script>
        // é¡¹ç›®ç­›é€‰å’Œæœç´¢åŠŸèƒ½
        class ProjectManager {
            constructor() {
                this.projects = Array.from(document.querySelectorAll('.project-card'));
                this.searchInput = document.getElementById('project-search');
                this.languageFilter = document.getElementById('language-filter');
                this.sortFilter = document.getElementById('sort-filter');
                this.clearButton = document.getElementById('clear-filters');
                
                this.init();
            }

            init() {
                this.searchInput?.addEventListener('input', () => this.filterProjects());
                this.languageFilter?.addEventListener('change', () => this.filterProjects());
                this.sortFilter?.addEventListener('change', () => this.sortProjects());
                this.clearButton?.addEventListener('click', () => this.clearFilters());
                
                // åˆå§‹æ’åº
                this.sortProjects();
            }

            filterProjects() {
                const searchTerm = this.searchInput.value.toLowerCase();
                const selectedLanguage = this.languageFilter.value;
                
                this.projects.forEach(project => {
                    const title = project.querySelector('.project-title').textContent.toLowerCase();
                    const description = project.querySelector('.project-description').textContent.toLowerCase();
                    const language = project.dataset.language;
                    
                    const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
                    const matchesLanguage = selectedLanguage === 'all' || language === selectedLanguage;
                    
                    if (matchesSearch && matchesLanguage) {
                        project.style.display = 'block';
                        project.style.animation = 'fadeIn 0.3s ease-in';
                    } else {
                        project.style.display = 'none';
                    }
                });
            }

            sortProjects() {
                const sortBy = this.sortFilter.value;
                const container = document.getElementById('projects-container');
                
                const sorted = [...this.projects].sort((a, b) => {
                    switch (sortBy) {
                        case 'stars':
                            return parseInt(b.dataset.stars) - parseInt(a.dataset.stars);
                        case 'name':
                            return a.dataset.name.localeCompare(b.dataset.name);
                        case 'created':
                            return new Date(b.dataset.created) - new Date(a.dataset.created);
                        case 'updated':
                        default:
                            return new Date(b.dataset.updated) - new Date(a.dataset.updated);
                    }
                });
                
                // é‡æ–°æ’åˆ—DOMå…ƒç´ 
                sorted.forEach(project => container.appendChild(project));
            }

            clearFilters() {
                this.searchInput.value = '';
                this.languageFilter.value = 'all';
                this.sortFilter.value = 'updated';
                this.filterProjects();
                this.sortProjects();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new ProjectManager();
            
            // æ·»åŠ è¿›å…¥åŠ¨ç”»
            const cards = document.querySelectorAll('.project-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>

    <style>
        /* é¡¹ç›®å¡ç‰‡åˆå§‹çŠ¶æ€ï¼ˆç”¨äºåŠ¨ç”»ï¼‰ */
        .project-card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* åŠ è½½åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-projects {
            grid-column: 1 / -1;
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            background: var(--card-bg);
            border-radius: 8px;
            border: 2px dashed var(--border-color);
        }

        .loading-indicator {
            text-align: center;
            padding: 2rem;
        }

        .loading-spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
{% endblock %}